"use strict";window.CONSTANTS={KEY_CODES:{ENTER:13,ESC:27},ROUGHNESS:{STEEL:.01,POLY:.002},DIAMETERS:{STEEL:{"21.3x2.8":1.57,"26.8x2.8":2.12,"33.5x3.2":2.71,"38x3":3.2,"42.3x3.2":3.59,"45x3":3.9,"48x3.5":4.1,"57x3":5.1,"76x3":7,"89x3":8.3,"108x3":10.2,"133x4":12.5,"159x4.5":15,"219x5":20.9,"273x5":26.3,"325x5":31.5,"426x6":41.4},POLY:{"40x3.7":3.26,"50x2.9":4.42,"63x3.6":5.58,"75x4.3":6.64,"90x5.2":7.96,"110x6.3":9.74,"125x7.1":11.08,"140x8":12.4,"160x9.1":14.18,"180x10.3":15.94,"200x11.4":17.72,"225x12.8":19.94,"250x14.2":22.16,"280x15.9":24.82,"315x17.9":27.92,"355x20.1":31.48,"400x22.7":35.46,"450x25.5":39.9,"500x28.4":44.32,"560x31.7":49.66,"630x35.7":55.86}}},window.utils={getRandomIndex:function(e){return Math.floor(Math.random()*e)},getRandomNumber:function(e,t){return Math.floor(Math.random()*(t-e))+e},getRandomFloatNumber:function(e,t,n){return(Math.random()*(t-e)+e).toFixed(n)},getRandomValue:function(e){return e[this.getRandomIndex(e.length)]},blockBodyScroll:function(){document.body.style.overflowY="hidden"},unblockBodyScroll:function(){document.body.style.overflowY="auto"},isEscKey:function(e){return e.keyCode===window.CONSTANTS.KEY_CODES.ESC}},window.formulas={estimatedLength:function(e,t){return e*(1+t/100)},inletPressure:function(e,t){return e-t},averagePressure:function(e,t,n){return(e+.5*(t+n))*Math.pow(10,-6)},averageHydraulicInc:function(e,t,n){return e*(t/n)},innerDiameter:function(e,t,n,a){return.036238*Math.sqrt(e*t/(n*a))},estimatedHydraulicInc:function(e,t,n,a,r){return 69*Math.pow(e/t+n*t*1922/a,.25)*(Math.pow(a,2)*r)/Math.pow(t,5)},reynoldsNumber:function(e,t,n){return.0354*e/(t*n)},pressureLossRe2000:function(e,t,n,a,r){return 1.132*Math.pow(10,6)*(e*t*n*r)/Math.pow(a,4)},pressureLossRe3000:function(e,t,n,a,r){return Math.pow(e,2.333)*t*n*.516/(Math.pow(a,5.333)*Math.pow(r,.333))},pressureLossRe4000:function(e,t,n,a,r,o){return 69*Math.pow(e/t+n*t*1922/a,.25)*(Math.pow(a,2)*r*o)/Math.pow(t,5)},pressureChange:function(e,t,n){return 9.81*e*(1.293-t)*n},totalPressureChange:function(e,t){return e+t},endingPressure:function(e,t){return e-t}},function(){var n="Введіть дані",a="Значення не може бути більше ",r="Значення не може бути менше ",o=function(e){e.classList.contains("data__input")?e.classList.add("data__input--error"):e.classList.add("data__table-input--error")},l=function(e){var t;e.validity.valueMissing?(e.setCustomValidity(n),e.reportValidity(),o(e)):e.validity.rangeUnderflow?(e.setCustomValidity(r+e.min),e.reportValidity(),o(e)):e.validity.rangeOverflow?(e.setCustomValidity(a+e.max),e.reportValidity(),o(e)):(e.setCustomValidity(""),(t=e).classList.contains("data__input")?t.classList.remove("data__input--error"):t.classList.remove("data__table-input--error"))},t=function(e){var t=e.querySelectorAll("input"),n=!0,a=[];return t.forEach(function(e){if(!e.checkValidity()){o(e),a.push(e);e.addEventListener("input",function(){l(e)}),n=!1}}),0<a.length&&l(a[0]),n};window.validation={isIncomeDataValid:function(){var e=document.querySelector("#income-data .data__fieldset");return t(e)},isIncomeSegmentsValid:function(){var e=document.querySelector("#income-segments .data__table-body");return t(e)}}}(),function(){var t=document.querySelector(".hamburger"),n=document.querySelector(".site-header__links-list"),a=document.querySelector(".menu-overlay"),r=function(e){e.preventDefault(),t.classList.toggle("is-active"),n.classList.toggle("site-header__links-list--show"),a.classList.toggle("menu-overlay--show"),t.classList.contains("is-active")?(window.utils.blockBodyScroll(),document.addEventListener("keydown",o)):(window.utils.unblockBodyScroll(),document.removeEventListener("keydown",o))},o=function(e){window.utils.isEscKey(e)&&r(e)};window.hamburger={activate:function(){t.addEventListener("click",r),a.addEventListener("click",r)}}}(),function(){var a=[],r=[25,20,450,300,120,50],l=function e(t){var n;switch(t){case"segment":n=window.utils.getRandomNumber(1,20)+"-"+window.utils.getRandomNumber(1,20),a.includes(n)?e("segment"):a.push(n);break;case"consumption":n=window.utils.getRandomFloatNumber(1,15,2);break;case"length":n=window.utils.getRandomFloatNumber(1,12,1);break;case"resist-coef":n=window.utils.getRandomValue(r)}return n};window.segments={buildTable:function(){for(var e=document.createDocumentFragment(),t=document.querySelector("#segments-amount").value,n=document.querySelector(".data__table--segments .data__table-body"),a=document.querySelector("#segments-row").content.querySelector(".data__table-row"),r=1;r<=t;r++){var o=a.cloneNode(!0);o.querySelector(".data__table-cell--number").textContent="Ділянка "+r,o.querySelector(".data__table-input--segment").placeholder=l("segment"),o.querySelector(".data__table-cell--consumption .data__input--definition sub").textContent=r,o.querySelector(".data__table-input--consumption").placeholder=l("consumption"),o.querySelector(".data__table-cell--length .data__input--definition sub").textContent=r,o.querySelector(".data__table-input--length").placeholder=l("length"),o.querySelector(".data__table-cell--resist-coef .data__input--definition sub").textContent=r,o.querySelector(".data__table-input--resist-coef").placeholder=l("resist-coef"),e.appendChild(o)}n.appendChild(e)},clear:function(){a.length=0;for(var e=document.querySelector(".data__table--segments .data__table-body");e.firstChild;)e.firstChild.remove()}}}(),function(){var t=document.querySelectorAll(".site-nav__button"),e=document.querySelector(".intro__button--begin"),n=document.querySelector(".data__button--next"),a=document.querySelector(".data__button--calc"),r=document.querySelector("#income-data"),o=document.querySelector("#income-segments"),l=document.querySelector("#results"),u={intro:"intro",data:"income-data",segments:"income-segments",results:"results"},s=function(e){document.querySelectorAll("section").forEach(function(e){e.classList.add("visually-hidden")}),e.classList.remove("visually-hidden")},i=function(e){document.querySelectorAll(".site-nav__button").forEach(function(e){e.classList.remove("site-nav__button--current")}),e.disabled=!1,e.classList.add("site-nav__button--current")},c=function(e){e.preventDefault();var n,t=e.target;s((t.className.split(" ").forEach(function(e){for(var t in u)e.includes(u[t])&&(n=document.querySelector("#"+u[t]))}),n)),i(t)},d=function(e){e.preventDefault(),s(r),i(t[1])},m=function(e){e.preventDefault(),window.validation.isIncomeDataValid()&&(window.segments.clear(),window.segments.buildTable(),o.querySelector("fieldset").disabled=!1,s(o),i(t[2]))},_=function(e){e.preventDefault(),window.validation.isIncomeSegmentsValid()&&(window.calculate.activate(),window.results.clear(),window.results.buildTable(),s(l),i(t[3]))};window.sections={activate:function(){t.forEach(function(e){e.addEventListener("click",c)}),e.addEventListener("click",d),n.addEventListener("click",m),a.addEventListener("click",_)},disable:function(){t.forEach(function(e){e.removeEventListener("click",c)}),e.removeEventListener("click",d),n.removeEventListener("click",m)}}}(),window.calculate={activate:function(){for(var e=document.querySelector("#income-data"),t=+e.querySelector("#allowable-pressure").value,n=+e.querySelector("#starting-pressure").value,a=+e.querySelector("#gas-density").value,r=+e.querySelector("#gas-viscosity").value*Math.pow(10,-6),o=+e.querySelector("#segments-amount").value,l=+e.querySelector("#overload-factor").value,u=+e.querySelector("#average-temperature").value+273,s=+e.querySelector("#calc-accurance").value/100,i=+e.querySelector("#atmospheric-pressure").value,c=+e.querySelector("#gas-speed").value,d=+e.querySelector("#gas-consumption").value,m=document.querySelector("#income-segments"),_=m.querySelectorAll(".data__table-input--segment"),p=m.querySelectorAll(".data__table-input--consumption"),w=m.querySelectorAll(".data__table-input--length"),f=m.querySelectorAll(".data__table-input--resist-coef"),v=m.querySelectorAll(".data__table-input--movement-direction"),y=m.querySelectorAll('input[name="pipe-type"]'),S=y[0].checked&&"steel"===y[0].value?window.CONSTANTS.DIAMETERS.STEEL:window.CONSTANTS.DIAMETERS.POLY,b=y[0].checked&&"steel"===y[0].value?window.CONSTANTS.ROUGHNESS.STEEL:window.CONSTANTS.ROUGHNESS.POLY,g=[],h=[],q=[],x=[],C=[],L=[],E=0,N=0;N<o;N++){g.push(_[N].value),h.push(parseFloat(p[N].value)),q.push(parseFloat(w[N].value)),x.push(parseFloat(f[N].value)),C.push(parseFloat(v[N].value));var k=parseFloat(window.formulas.estimatedLength(w[N].value,f[N].value));L.push(k),E+=k}for(var M=window.formulas.inletPressure(n,t),T=window.formulas.averagePressure(i,n,M),R=window.formulas.averageHydraulicInc(l,t,E),A=0,D=c;s<Math.abs(A-R);D-=.001){var O=window.formulas.innerDiameter(d,u,T,D);A=window.formulas.estimatedHydraulicInc(b,O,r,d,a)}for(var P=[],F=[],V=[],I=[],Y=[],H=[],B=0,K=0;K<o;K++){var U=window.formulas.innerDiameter(h[K],u,T,D);for(var G in S)if(!(0<U-S[G])){U=S[G],P.push(G);break}var j=window.formulas.reynoldsNumber(h[K],U,r);if(4e3<=j)var z=window.formulas.pressureLossRe4000(b,U,r,h[K],a,L[K]);else z=2e3<=j&&j<4e3?window.formulas.pressureLossRe3000(h[K],a,L[K],U,r):window.formulas.pressureLossRe2000(h[K],r,a,U,L[K]);var J=window.formulas.pressureChange(q[K],a,C[K]),Q=window.formulas.totalPressureChange(z,J);B+=Q;var W=window.formulas.endingPressure(n,Q);n=W,F.push(j.toFixed()),V.push(z.toFixed()),I.push(J.toFixed()),Y.push(Q.toFixed()),H.push(W.toFixed())}window.calculate.results={segmentsName:g,lengths:q,consumptions:h,diameters:P,pressureLosses:V,pressureChanges:I,sumPressureChange:Y,endingPressure:H,velocity:D,sumPressureLoss:B}}},window.results={buildTable:function(){for(var e=window.calculate.results,t=document.createDocumentFragment(),n=+document.querySelector("#segments-amount").value,a=document.querySelector(".data__table--results .data__table-body"),r=document.querySelector("#results-row").content.querySelector(".data__table-row"),o=0;o<n;o++){var l=r.cloneNode(!0);l.querySelector(".data__table-cell--segment").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--length .data__input--definition sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--length .data__value").textContent=e.lengths[o],l.querySelector(".data__table-cell--consumption .data__input--definition sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--consumption .data__value").textContent=e.consumptions[o],l.querySelector(".data__table-cell--diameter").textContent=e.diameters[o],l.querySelector(".data__table-cell--pressure-loss .data__input--definition sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--pressure-loss .data__value").textContent=e.pressureLosses[o],l.querySelector(".data__table-cell--pressure-drop .data__input--definition .data__sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--pressure-drop .data__value").textContent=e.pressureChanges[o],l.querySelector(".data__table-cell--total-pressure-drop .data__input--definition .data__sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--total-pressure-drop .data__value").textContent=e.sumPressureChange[o],l.querySelector(".data__table-cell--ending-pressure .data__input--definition .data__sub").textContent=e.segmentsName[o],l.querySelector(".data__table-cell--ending-pressure .data__value").textContent=e.endingPressure[o],t.appendChild(l)}a.appendChild(t)},clear:function(){for(var e=document.querySelector(".data__table--results .data__table-body");e.firstChild;)e.firstChild.remove()}},document.addEventListener("DOMContentLoaded",function(){window.sections.activate(),window.hamburger.activate()});